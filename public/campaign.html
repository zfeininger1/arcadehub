<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Hub - Campaign Mode</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Poppins:wght@300;400;600;700;900&display=swap"
        rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background: #0a0a0a;
            color: white;
            position: relative;
        }

        /* Animated Grid Background */
        .grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(255, 0, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            z-index: 0;
        }

        @keyframes gridMove {
            0% {
                transform: perspective(500px) rotateX(60deg) translateY(0);
            }

            100% {
                transform: perspective(500px) rotateX(60deg) translateY(50px);
            }
        }

        /* Neon glow overlay */
        .neon-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(255, 0, 255, 0.15) 0%, transparent 70%);
            z-index: 0;
            pointer-events: none;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(15, 12, 41, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav .user-info {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            color: #00ffff;
        }

        nav .logout-btn {
            padding: 8px 20px;
            background: transparent;
            border: 2px solid #ff00ff;
            border-radius: 50px;
            color: #ff00ff;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        nav .logout-btn:hover {
            background: #ff00ff;
            color: #fff;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            margin-top: 80px;
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        /* Campaign Progress Path */
        .campaign-path {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .game-node {
            text-align: center;
            position: relative;
        }

        .game-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .game-node.active .game-icon {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            animation: pulse 2s infinite;
        }

        .game-node.completed .game-icon {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .game-node.locked .game-icon {
            border-color: #666;
            background: rgba(100, 100, 100, 0.1);
            opacity: 0.5;
            cursor: not-allowed;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            }

            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.8);
            }
        }

        .game-label {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6rem;
            margin-top: 10px;
            color: #fff;
        }

        .connector {
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, transparent, #666, transparent);
        }

        .connector.active {
            background: linear-gradient(90deg, #00ffff, #ff00ff);
        }

        /* Game Area */
        .game-area {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px);
            border: 3px solid #ff00ff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.3);
            margin-bottom: 30px;
        }

        .game-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: #00ffff;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-instructions {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .game-instructions h3 {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            color: #ff00ff;
            margin-bottom: 15px;
        }

        .game-instructions p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .win-condition {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .win-condition strong {
            color: #00ff00;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
        }

        /* iframe for game */
        #gameFrame {
            width: 100%;
            height: 700px;
            border: none;
            border-radius: 10px;
            background: #000;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border: 3px solid;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content.success {
            border-color: #00ff00;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
        }

        .modal-content.failure {
            border-color: #ff0000;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.5);
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .success .modal-title {
            color: #00ff00;
        }

        .failure .modal-title {
            color: #ff0000;
        }

        .modal-message {
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 0, 255, 0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .campaign-path {
                gap: 10px;
            }

            .game-icon {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .connector {
                width: 20px;
            }

            #gameFrame {
                height: 500px;
            }
        }
    </style>
</head>

<body>
    <div class="grid-background"></div>
    <div class="neon-overlay"></div>

    <!-- Navigation -->
    <nav>
        <div class="user-info">
            Player: <span id="usernameDisplay">---</span>
        </div>
        <a href="login.html" class="logout-btn" onclick="localStorage.clear()">LOGOUT</a>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <h1>üéÆ CAMPAIGN MODE üéÆ</h1>

        <!-- Campaign Progress Path -->
        <div class="campaign-path">
            <div class="game-node active" id="node-0">
                <div class="game-icon">üêç</div>
                <div class="game-label">SNAKE</div>
            </div>
            <div class="connector" id="connector-0"></div>
            <div class="game-node locked" id="node-1">
                <div class="game-icon" id="icon-1">üèì</div>
                <div class="game-label" id="label-1">PONG</div>
            </div>
            <div class="connector" id="connector-1"></div>
            <div class="game-node locked" id="node-2">
                <div class="game-icon" id="icon-2">üëª</div>
                <div class="game-label" id="label-2">PAC-MAN</div>
            </div>
            <div class="connector" id="connector-2"></div>
            <div class="game-node locked" id="node-3">
                <div class="game-icon" id="icon-3">üê¶</div>
                <div class="game-label" id="label-3">FLAPPY BIRD</div>
            </div>
            <div class="connector" id="connector-3"></div>
            <div class="game-node locked" id="node-4">
                <div class="game-icon" id="icon-4">üëæ</div>
                <div class="game-label" id="label-4">GALAGA</div>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area">
            <h2 class="game-title" id="gameTitle">üêç LEVEL 1: SNAKE</h2>

            <div class="game-instructions" id="gameInstructions">
                <h3>Mission Briefing</h3>
                <p id="instructionText">Use <strong>W A S D</strong> to control the snake.<br>
                    Eat food to grow longer and increase your score.<br>
                    Avoid hitting walls or yourself!</p>

                <div class="win-condition" id="winCondition">
                    <strong>üéØ Win Condition:</strong> Reach a score of 10 or higher
                </div>
            </div>

            <!-- Game iframe -->
            <iframe id="gameFrame" src="games/snake.html?campaign=true"></iframe>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content success">
            <div class="modal-icon">üéâ</div>
            <h2 class="modal-title">VICTORY!</h2>
            <p class="modal-message" id="successMessage">
                Congratulations! You've completed this level.<br>
                <span id="scoreInfo">Score: <span id="finalScore">0</span></span>
            </p>
            <button class="modal-btn" onclick="location.reload()">CONTINUE</button>
        </div>
    </div>

    <!-- Failure Modal -->
    <div class="modal-overlay" id="failureModal">
        <div class="modal-content failure">
            <div class="modal-icon">üíÄ</div>
            <h2 class="modal-title">GAME OVER</h2>
            <p class="modal-message" id="failureMessage">
                You didn't reach the target.<br>
                <span id="failInfo"></span>
            </p>
            <button class="modal-btn" onclick="retryGame()">TRY AGAIN</button>
        </div>
    </div>

    <script>
        // API Configuration
        const CAMPAIGN_API = 'https://wdfkm7efyc.execute-api.us-east-2.amazonaws.com/DEV/campaign-progress';

        // Game configurations
        const GAMES = [
            {
                name: 'Snake',
                emoji: 'üêç',
                url: 'games/snake.html?campaign=true',
                instructions: 'Use <strong>W A S D</strong> to control the snake.<br>Eat food to grow longer and increase your score.<br>Avoid hitting walls or yourself!',
                winCondition: 'üéØ Win Condition: Reach a score of 10 or higher'
            },
            {
                name: 'Pong',
                emoji: 'üèì',
                url: 'games/pong.html?campaign=true',
                instructions: 'Use <strong>W S</strong> keys to move your paddle up and down.<br>Defeat the AI opponent!<br>Ball speed increases on paddle hits.',
                winCondition: 'üéØ Win Condition: Score 5 points before the AI'
            },
            {
                name: 'Pac-Man',
                emoji: 'üëª',
                url: 'games/pacman.html?campaign=true',
                instructions: 'Use <strong>W A S D</strong> keys to move Pac-Man.<br>Eat all the dots to win!<br>Avoid ghosts or eat power pellets to chase them!',
                winCondition: 'üéØ Win Condition: Complete one level (eat all dots)'
            },
            {
                name: 'Flappy Bird',
                emoji: 'üê¶',
                url: 'games/flappy_bird.html?campaign=true',
                instructions: 'Press <strong>W</strong> to jump!<br>Navigate through the pipes without crashing.<br>Keep flying to rack up points!',
                winCondition: 'üéØ Win Condition: Pass 10 pipes successfully'
            },
            {
                name: 'Galaga',
                emoji: 'üëæ',
                url: 'games/galaga.html?campaign=true',
                instructions: 'Use <strong>A D</strong> to move your ship, <strong>SPACE</strong> to shoot.<br>Destroy all alien invaders!<br>Avoid enemy fire and dive attacks.',
                winCondition: 'üéØ Win Condition: Defeat 2 waves of enemies'
            }
        ];

        // Get user and campaign progress
        const username = localStorage.getItem('arcadeUser');
        let campaignProgress = parseInt(localStorage.getItem('campaignProgress') || '0');

        // Check if campaign is complete - redirect immediately
        if (campaignProgress >= 5) {
            window.location.href = 'congratulations.html';
        }

        // If not logged in, redirect to login
        if (!username) {
            window.location.href = 'login.html';
        }

        document.getElementById('usernameDisplay').textContent = username;

        // Load the current game based on progress
        function loadCurrentGame() {
            const currentGame = GAMES[campaignProgress] || GAMES[0];
            const levelNum = campaignProgress + 1;

            // Update UI
            document.getElementById('gameTitle').textContent = `${currentGame.emoji} LEVEL ${levelNum}: ${currentGame.name.toUpperCase()}`;
            document.getElementById('instructionText').innerHTML = currentGame.instructions;
            document.getElementById('winCondition').innerHTML = `<strong>${currentGame.winCondition}</strong>`;
            document.getElementById('gameFrame').src = currentGame.url;
        }

        // Update campaign path based on progress
        function updateCampaignPath(progress) {
            // Mark completed levels
            for (let i = 0; i < progress; i++) {
                const node = document.getElementById(`node-${i}`);
                if (node) {
                    node.classList.remove('locked', 'active');
                    node.classList.add('completed');
                }
                const connector = document.getElementById(`connector-${i}`);
                if (connector) {
                    connector.classList.add('active');
                }
            }

            // Mark current level as active
            const currentNode = document.getElementById(`node-${progress}`);
            if (currentNode) {
                currentNode.classList.remove('locked', 'completed');
                currentNode.classList.add('active');
            }
        }

        // Initialize
        loadCurrentGame();
        updateCampaignPath(campaignProgress);

        // Listen for messages from the game iframe
        window.addEventListener('message', async (event) => {
            const data = event.data;
            console.log('Received message from game:', data);

            if (data.type === 'gameOver') {
                // Handle different game types
                if (campaignProgress === 0) {
                    // Snake game
                    const score = data.score;
                    const WIN_THRESHOLD = 10;

                    if (score >= WIN_THRESHOLD) {
                        showSuccessModal(score);
                        await updateCampaignProgress(campaignProgress + 1, score);
                    } else {
                        showFailureModal(score, WIN_THRESHOLD);
                    }
                } else if (campaignProgress === 1) {
                    // Pong game
                    const playerWon = data.playerWon;
                    const playerScore = data.playerScore;
                    const aiScore = data.aiScore;

                    if (playerWon) {
                        showSuccessModalPong(playerScore, aiScore);
                        await updateCampaignProgress(campaignProgress + 1, playerScore);
                    } else {
                        showFailureModalPong(playerScore, aiScore);
                    }
                } else if (campaignProgress === 2) {
                    // Pac-Man game
                    const levelCompleted = data.levelCompleted;
                    const score = data.score;

                    if (levelCompleted) {
                        showSuccessModalPacman(score);
                        await updateCampaignProgress(campaignProgress + 1, score);
                    } else {
                        showFailureModalPacman(score);
                    }
                } else if (campaignProgress === 3) {
                    // Flappy Bird game
                    const score = data.score;
                    const WIN_THRESHOLD = 10;

                    if (score >= WIN_THRESHOLD) {
                        showSuccessModalFlappy(score);
                        await updateCampaignProgress(campaignProgress + 1, score);
                    } else {
                        showFailureModalFlappy(score);
                    }
                } else if (campaignProgress === 4) {
                    // Galaga game
                    const wavesCompleted = data.wavesCompleted;
                    const score = data.score;

                    if (wavesCompleted >= 1) {
                        showSuccessModalGalaga(score, wavesCompleted);
                        // Complete the campaign!
                        await updateCampaignProgress(campaignProgress + 1, score);
                        // Redirect to congratulations page after a brief delay
                        setTimeout(() => {
                            window.location.href = 'congratulations.html';
                        }, 2000);
                    } else {
                        showFailureModalGalaga(score, wavesCompleted);
                    }
                }
            }
        });

        function showSuccessModal(score) {
            document.getElementById('scoreInfo').innerHTML = `Score: <span id="finalScore">${score}</span>`;
            document.getElementById('successModal').classList.add('show');
        }

        function showSuccessModalPong(playerScore, aiScore) {
            document.getElementById('scoreInfo').innerHTML = `Final Score: ${playerScore} - ${aiScore}`;
            document.getElementById('successModal').classList.add('show');
        }

        function showSuccessModalPacman(score) {
            document.getElementById('scoreInfo').innerHTML = `Level Complete!<br>Score: ${score}`;
            document.getElementById('successModal').classList.add('show');
        }

        function showSuccessModalFlappy(score) {
            document.getElementById('scoreInfo').innerHTML = `Pipes Passed: ${score}`;
            document.getElementById('successModal').classList.add('show');
        }

        function showSuccessModalGalaga(score, waves) {
            document.getElementById('scoreInfo').innerHTML = `Waves Cleared: ${waves}<br>Score: ${score}`;
            document.getElementById('successModal').classList.add('show');
        }

        function showFailureModal(score, threshold) {
            document.getElementById('failInfo').innerHTML = `Score: ${score}<br>Need: ${threshold} or higher`;
            document.getElementById('failureModal').classList.add('show');
        }

        function showFailureModalPong(playerScore, aiScore) {
            document.getElementById('failInfo').innerHTML = `Final Score: ${playerScore} - ${aiScore}<br>You need to score 5 points first!`;
            document.getElementById('failureModal').classList.add('show');
        }

        function showFailureModalPacman(score) {
            document.getElementById('failInfo').innerHTML = `Game Over!<br>Score: ${score}<br>You were caught by ghosts`;
            document.getElementById('failureModal').classList.add('show');
        }

        function showFailureModalFlappy(score) {
            document.getElementById('failInfo').innerHTML = `Pipes Passed: ${score}<br>Need: 10 pipes to win`;
            document.getElementById('failureModal').classList.add('show');
        }

        function showFailureModalGalaga(score, waves) {
            document.getElementById('failInfo').innerHTML = `Waves Cleared: ${waves}/1<br>Score: ${score}<br>You were defeated!`;
            document.getElementById('failureModal').classList.add('show');
        }

        function retryGame() {
            // Reload the page to restart the game
            location.reload();
        }

        async function updateCampaignProgress(level, score) {
            try {
                // For demo purposes, if API URL is placeholder, just update localStorage
                if (CAMPAIGN_API.includes('YOUR_API_GATEWAY_URL')) {
                    console.log('Simulating campaign progress update:', level);
                    localStorage.setItem('campaignProgress', level.toString());
                    return;
                }

                const response = await fetch(CAMPAIGN_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'update_progress',
                        username: username,
                        level: level,
                        score: score
                    })
                });

                const data = await response.json();
                const result = data.body ? JSON.parse(data.body) : data;

                if (response.ok || data.statusCode === 200) {
                    console.log('Campaign progress updated:', result);
                    localStorage.setItem('campaignProgress', level.toString());
                } else {
                    console.error('Failed to update campaign progress:', result);
                }
            } catch (error) {
                console.error('Error updating campaign progress:', error);
            }
        }
    </script>
</body>

</html>